---
title: "Final Project..."
author: "Ben Essex, Derek Che, & Chris Marston"
date: 04/02/2022
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*******************************
**HARD DEADLINE: Wed 20 @ 6PM**
*******************************

## Introduction

The COVID-19 pandemic has redefined many aspects of our lives especially how we interact with others. One such example is the advent of online learning at all levels of education to reduce contact between students and thereby avoid disease transmission. Students today enjoy the ability to tune into lectures remotely from anywhere with internet, as opposed to sitting in school, redefining the classroom setting. This was the status quo for a year while COVID remained rampant, but through the gradual vaccination status of the population and decreasing COVID cases, many schools have returned to a hybrid model: offering classes in-person that are broadcasted online. This is observable in our lives as many of the Computer Science courses at the University of Utah teach in classrooms, but also stream lectures through the video conferencing app Zoom. Given that COVID is less of a concern now and that people attend these Zoom lectures, we wanted to investigate potential variables that predict attendance. This led to the questions:

1.    Do COVID case rates affect Zoom lecture attendance?

2.    Does weather predict Zoom lecture attendance?

### Questions

**"Do COVID case rates affect Zoom lecture attendance?"**

LIST SPECIFIC QUESTIONS WE WILL ANSWER HERE

**"Does weather predict Zoom lecture attendance?"**

LIST SPECIFIC QUESTIONS WE WILL ANSWER HERE


These are the original questions we had proposed broken down into a more "testable" format as per Scott's instructions.

- "Does weather predict Zoom lecture attendance?
    - "Does the temperature 2 hours before lecture affect Zoom lecture attendance?"
    - "Does the temperature 1 hour before lecture affect Zoom lecture attendance?"
    - "Does the temperature at the start of lecture affect Zoom lecture attendance?"
- "Do University of Utah Covid case rates affect Zoom lecture attendance?"
    - "Is Zoom lecture attendance affected by the total number of new Covid Cases at the University of Utah?"
    - "Is Zoom lecture attendance affected by the 7-day average of new Covid case rates at the University of Utah?"
- "Do Salt Lake County Covid case rates affect Zoom lecture attendance?"
    - "Is Zoom lecture attendance affected by the 7-day average case rate per 100,000 in SLC County?"
    - "Is Zoom lecture attendance affected by the SLC County Covid case rates per 100,000?"
    - "Is Zoom lecture attendance affected by the 7-day average positive test rate in SLC County?"

FOCUSED QUESTIONS LIST 

- "Does the mean temperature before class starts affect Zoom attendence?" (use the mean temp from T+2, T+1, & T=0)
- "Does the 7 day average case rate per 100k in Utah affect Zoom attendence?"
- "Does the Salt Lake County percent positive test rate affect Zoom attendence?"


## Planning: Data Collection

To answer the previously posed questions, we decided to collect attendance data from Zoom for hybrid Computer Science courses at the University of Utah as well as local weather and COVID case number data. The courses sampled from were CS 3500, CS 4400, CS 3200, CS 5140, and CS 3130 where data would be collected every lecture spanning ~10 weeks. Zoom attendance data would be collected three times per lecture: 10 minutes after class started, halfway through class, and 10 minutes before the end of class. Attendance then would be calculated by taking the total number of participants in the Zoom lecture and subtracting one for the teacher. Temperature data for the day of each lecture would be obtained from OpenWeatherMap <https://openweathermap.org/city/5780993>, where the temperature was recorded two hours before the class, one hour before the class, and when class started. Moreover, we will record the weather condition when class starts from the same source. For COVID cases, we decided to look at data near the University of Utah: specifically data from the university itself  <https://coronavirus.utah.edu> and from Salt Lake County <https://coronavirus.utah.gov/case-counts>. From the University data, we will look at the total new cases in a day and the 7-day average of new cases. 

#TODO (add outline comments)

Due to the breadth of scope of the two questions being answered in this study, data was gathered from a range of sources.

**Salt Lake County Covid Data**

- Data was gathered from the Utah Covid Dashboard (overview) website [here](https://coronavirus-dashboard.utah.gov/overview.html) 

**University of Utah Covid Data**

- Data was gathered from the University of Utah Covid information page.
- Important Notes:
    - The U stopped posting Covid data to their public site partway through the collection period.
        - Currently attempting to get the data from them directly...

**Weather Data**

Weather data was pulled from:

- DarkSky for first part of data collection period.
- OpenWeather for last part of data collection period.
- Important Notes:
    - We switched data collection sources part way through the collection period.

**Zoom Attendance Data (headcounts)**

- Gathered directly by attending Zoom and recording attendee count by Zoom.
    - Professor excluded from count.
    - Excluded ourselves if we would have attended in person otherwise.
    - TAs were left in the counts - too difficult to remove them accurately.
    - Attendees counts were taken 10 min into the lecture, at the halfway point, and 10 min before the lecture ended.


## Methodology

#TODO (add outline comments)

## Analysis

#TODO (add outline comments)

```{r}
# import libraries
# data <- read csvs

# +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
# |  Date |  T+10 | T+40 | T+70 | mean(...) | Temp T-2 | Temp T-1 | Temp T-0 | Weather | Class | UU New Cases | UU 7-Day Avg New Cases | SLCo Case Rate | SLCo 7-Day Avg Case Rate| SLCo 7-Day Avg Positive Test Rate | 
# +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

# regression analyses:
#   - stimulus: nominal_weather, response: mean_attendance
#     - logistic regression(?)
#   - stimulus: temperature ->
#     - linear regression
#     - T-2 -> mean_attendance
#     - T-1 -> mean_attendance
#     - T-0 -> mean_attendance
#   - stimulus: COVID... ->
#     - linear regression
#     - uu_new_cases -> mean_attendance
#     - uu_new_cases_7day_avg -> mean_attendance
#     - slco_case_rate -> mean_attendance
#     - slco_case_rate_7day_avg -> mean_attendance
#     - slco_pos_test_rate_7day_avg -> mean_attendance
#   - more?

# correlation coefficients
#   - confidence interval
#   - point estimate
```

```{r}
# READING IN DATA

atd_and_weather_data = read.csv("data/3130 Final Project Data Sheet - Atd & Weather.csv")
atd_daily_temp_and_covid = read.csv("data/3130 Final Project Data Sheet - Mean Atd Rate, Mean Daily Temp, & COVID-19.csv")

```

```{R}
# GENERATING VISUALIZATIONS




```

```{R}
# FUNCTIONS

# Confidence Interval Calculation: https://www.statology.org/confidence-interval-correlation-coefficient/
# z-score Calculation: https://www.statology.org/z-score-r/

Fisher_Transformation = function(correlation_coefficent) {
    return(
        log( ( (1 + correlation_coefficent) / (1 - correlation_coefficent) ) ) / 2
    )
}

# Use our corellation coefficent for the data_value here
Z_Score = function(data_value, sample_mean, sample_sd) {
    return(
        ( data_value - sample_mean ) / sample_sd
    )
}

Log_Bounds = function(upper, fisher_transformed, z_score, sample_size) {
    if (upper == TRUE) # Calculate the upper bound
    {
        return(
            fisher_transformed + ( z_score / sqrt( sample_size - 3) )
        )
    }
    else # If upper is false, default to calculating the lower bound
    {
        return(
            fisher_transformed - ( z_score / sqrt( sample_size - 3) )
        )
    }
}

CI_Upper = function(log_upper_bound) {
    return(
        (exp(2 * log_upper_bound) - 1) / (exp(2 * log_upper_bound) + 1 )
    )
}

CI_Lower = function(log_lower_bound) {
    return(
        (exp(2 * log_lower_bound) - 1) / (exp(2 * log_lower_bound) + 1 )
    )
}


```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- mean_daily_temp

# Find the Correlation Coefficent
mean_daily_temp_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$mean_daily_temp)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_temp_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence - assumes normally distributed data

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_temp = CI_Upper(log_upper_bound)

CI_lower_atd_vs_temp = CI_Lower(log_lower_bound)

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INFERVALS FOR mean_daily_atd_rate --- daily_confirmed_case_count

# Find the Correlation Coefficent
mean_daily_case_count_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                        atd_daily_temp_and_covid$daily_confirmed_case_count)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_case_count_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_case_count = CI_Upper(log_upper_bound)

CI_lower_atd_vs_case_count = CI_Lower(log_lower_bound)

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- confirmed_case_count_7d_avg (confirmed_7dcc)

# Find the Correlation Coefficent
mean_daily_confirmed_7dcc_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$confirmed_case_count_7d_avg)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_confirmed_7dcc_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_confirmed_7dcc = CI_Upper(log_upper_bound)

CI_lower_atd_vs_confirmed_7dcc = CI_Lower(log_lower_bound)

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- positive_test_rate_7d_avg (positive_7dtr)

# Find the Correlation Coefficent
mean_daily_positive_7dtr_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$positive_test_rate_7d_avg)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_positive_7dtr_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_positive_7dtr = CI_Upper(log_upper_bound)

CI_lower_atd_vs_positive_7dtr = CI_Lower(log_lower_bound)

```




## Limitations

One big limitation of the study was the fact that the courses chosen to study were a convenience sample. These were the classes that we were in and thus were easily accessible to collect data from. The implications of this are that our sample probably does a poor job

Zoom attendance could contain TAs.

Data is non continuous (holes for dates of labs and midterms)

Not representative of the University population.

COVID cases today may not impact attendance of the same day.

#TODO (add outline comments)

## Conclusions

#TODO (add outline comments)