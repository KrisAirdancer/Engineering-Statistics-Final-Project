---
title: "Final Project..."
author: "Ben Essex, Derek Che, & Chris Marston"
date: 04/02/2022
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

#TODO (add outline comments)

**PROPOSED QUESTIONS** #TODO (we might want to slim these down a bit)

These are the two primary questions we originally set out to answer.

- "Do Covid case rates affect Zoom lecture attendance?"
- "Does weather predict Zoom lecture attendance?"

These are the original questions we had proposed broken down into a more "testable" format as per Scott's instructions.

- "Does weather predict Zoom lecture attendance?
    - "Does the temperature 2 hours before lecture affect Zoom lecture attendance?"
    - "Does the temperature 1 hour before lecture affect Zoom lecture attendance?"
    - "Does the temperature at the start of lecture affect Zoom lecture attendance?"
- "Do University of Utah Covid case rates affect Zoom lecture attendance?"
    - "Is Zoom lecture attendance affected by the total number of new Covid Cases at the University of Utah?"
    - "Is Zoom lecture attendance affected by the 7-day average of new Covid case rates at the University of Utah?"
- "Do Salt Lake County Covid case rates affect Zoom lecture attendance?"
    - "Is Zoom lecture attendance affected by the 7-day average case rate per 100,000 in SLC County?"
    - "Is Zoom lecture attendance affected by the SLC County Covid case rates per 100,000?"
    - "Is Zoom lecture attendance affected by the 7-day average positive test rate in SLC County?"

FOCUSED QUESTIONS LIST 

- "Does the mean temperature before class starts affect Zoom attendence?" (use the mean temp from T+2, T+1, & T=0)
- "Does the 7 day average case rate per 100k in Utah affect Zoom attendence?"
- "Does the Salt Lake County percent positive test rate affect Zoom attendence?"



## Data Collection

#TODO (add outline comments)

Due to the breadth of scope of the two questions being answered in this study, data was gathered from a range of sources.

**Salt Lake County Covid Data**

- Data was gathered from the Utah Covid Dashboard (overview) website [here](https://coronavirus-dashboard.utah.gov/overview.html) 

**University of Utah Covid Data**

- Data was gathered from the University of Utah Covid information page.
- Important Notes:
    - The U stopped posting Covid data to their public site partway through the collection period.
        - Currently attempting to get the data from them directly...

**Weather Data**

Weather data was pulled from:

- DarkSky for first part of data collection period.
- OpenWeather for last part of data collection period.
- Important Notes:
    - We switched data collection sources part way through the collection period.

**Zoom Attendance Data (headcounts)**

- Gathered directly by attending Zoom and recording attendee count by Zoom.
    - Professor excluded from count.
    - Excluded ourselves if we would have attended in person otherwise.
    - TAs were left in the counts - too difficult to remove them accurately.
    - Attendees counts were taken 10 min into the lecture, at the halfway point, and 10 min before the lecture ended.


## Methodology

#TODO (add outline comments)

## Analysis

#TODO (add outline comments)

```{r}
# import libraries
# data <- read csvs

# +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
# |  Date |  T+10 | T+40 | T+70 | mean(...) | Temp T-2 | Temp T-1 | Temp T-0 | Weather | Class | UU New Cases | UU 7-Day Avg New Cases | SLCo Case Rate | SLCo 7-Day Avg Case Rate| SLCo 7-Day Avg Positive Test Rate | 
# +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

# regression analyses:
#   - stimulus: nominal_weather, response: mean_attendance
#     - logistic regression(?)
#   - stimulus: temperature ->
#     - linear regression
#     - T-2 -> mean_attendance
#     - T-1 -> mean_attendance
#     - T-0 -> mean_attendance
#   - stimulus: COVID... ->
#     - linear regression
#     - uu_new_cases -> mean_attendance
#     - uu_new_cases_7day_avg -> mean_attendance
#     - slco_case_rate -> mean_attendance
#     - slco_case_rate_7day_avg -> mean_attendance
#     - slco_pos_test_rate_7day_avg -> mean_attendance
#   - more?

# correlation coefficients
#   - confidence interval
#   - point estimate
```

**TODO**

- [ ] Need to figure out how many students are enrolled in each class
    - We need to get the attendence _rate_, not raw attendence counts.
    - Can get these from CIS on the course catalouge page for each class period.

1. Decide on the data sets we want to use for covid cases
2. Load data into R-table as per outline above (table headers)
3. Clean data
    - Attendence Data
        - Calculate the average raw attendence count for each day recorded for each class
        - Calculate attendence rate for each day recored for each class
        - Calculate the average attendence rate for all classes recorded on each day
        - (this gives us a single attendence value for each day to match with our single covid data point for each day)
    - Pull data for desired date range (this sememster) from Covid data
        - This should yield a single data point for each day automatically (per metric)
4. Visualize data with...
    - 7-day Average Case Counts (Utah State Daily Case Count & 7-Day Avg Case Count)
5. Calcualte correlation coefficient point estimate
6. Calculate correlation coefficient confidence interval


```{r}
# READING IN DATA

atd_and_weather_data = read.csv("data/3130 Final Project Data Sheet - Atd & Weather.csv")
atd_daily_temp_and_covid = read.csv("data/3130 Final Project Data Sheet - Mean Atd Rate, Mean Daily Temp, & COVID-19.csv")

```

```{R}
# GENERATING VISUALIZATIONS




```

```{R}
# FUNCTIONS

# s_1, s_2: sample standard deviations
# x_1, x_2: sample means
# n_1, n_2: sample sizes

# pooled_sd = sqrt( ( (n_1 - 1) * (s_1)^2 + (n_2 - 1) * (s_2)^2 ) / ( n_1 + n_2 - 2 ) )

PooledStandardDeviation = function(n_1, n_2, x_1, x_2, s_1, s_2) {
    return(
        sqrt( ( (n_1 - 1) * (s_1)^2 + (n_2 - 1) * (s_2)^2 ) / ( n_1 + n_2 - 2 ) )
    )
}

# Two variable CI = (x_1 - x_2) +/- t_value * pooled_sd * sqrt( (1 / s_1) + (1 / s_2) )

CILower = function(pooled_sd, z_score, x_1, x_2, n_1, n_2) { # Entered t-value shoud be positive
    return(
        abs( (x_1 - x_2) ) - z_score * pooled_sd * sqrt( (1 / n_1) + (1 / n_2) )
    )
}

CIUpper = function(pooled_sd, z_score, x_1, x_2, n_1, n_2) { # Entered t-value shoud be positive
    return(
        abs( (x_1 - x_2) ) + z_score * pooled_sd * sqrt( (1 / n_1) + (1 / n_2) )
    )
}

OneTailedTTest = function(confidence_level, degrees_freedom){
    return(
        abs( qt(1 - confidence_level, degrees_freedom) )
    )
}

TwoTailedTTest = function(confidence_level, degrees_freedom){
    return(
        abs( qt( (1 - confidence_level) / 2, degrees_freedom) )
    )
}

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- mean_daily_temp

# Correlation coefficent ALT
cor.test() # TODO: figure out how to use this...(see here: https://bookdown.org/ndphillips/YaRrr/correlation-cor-test.html)

# Correlation coefficent
mean_daily_temp_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$mean_daily_temp)

mean_daily_atd_rate_mean = mean(atd_daily_temp_and_covid$mean_daily_atd_rate)
mean_daily_atd_rate_sd = sd(atd_daily_temp_and_covid$mean_daily_atd_rate)
mean_daily_atd_rate_sample_size = length(atd_daily_temp_and_covid$mean_daily_atd_rate)

mean_daily_temp_mean = mean(atd_daily_temp_and_covid$mean_daily_temp)
mean_daily_temp_sd = sd(atd_daily_temp_and_covid$mean_daily_temp)
mean_daily_temp_sample_size = length(atd_daily_temp_and_covid$mean_daily_temp)

# Degrees of Freedom = n_1 + n_2 - 2
atd_rate_vs_temp_pooled_dof = mean_daily_atd_rate_sample_size + mean_daily_temp_sample_size - 2

# Pooled Standard Deviation
atd_rate_vs_temp_pooled_sd = PooledStandardDeviation(mean_daily_atd_rate_sample_size,
                                      mean_daily_temp_sample_size,
                                      mean_daily_atd_rate_mean,
                                      mean_daily_temp_mean,
                                      mean_daily_atd_rate_sd,
                                      mean_daily_temp_sd
                                     )

# Confidence Interval

# t-value - TODO: I don't think we need the t-value after all
atd_rate_vs_temp_t_value = TwoTailedTTest(0.95, atd_rate_vs_temp_pooled_dof)

# Might be able to use fisher.test here instead, but not sure how to do it...
atd_rate_vs_temp_CI_upper = CIUpper(atd_rate_vs_temp_pooled_sd,
                   1.96,
                   mean_daily_atd_rate_mean,
                   mean_daily_temp_mean,
                   mean_daily_atd_rate_sample_size,
                   mean_daily_temp_sample_size)

atd_rate_vs_temp_CI_lower = CILower(atd_rate_vs_temp_pooled_sd,
                   1.96,
                   mean_daily_atd_rate_mean,
                   mean_daily_temp_mean,
                   mean_daily_atd_rate_sample_size,
                   mean_daily_temp_sample_size)

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INFERVALS FOR mean_daily_atd_rate --- daily_confirmed_case_count

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- confirmed_case_count_7d_avg

```

```{r}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- positive_test_rate_7d_avg

```




## Limitations

#TODO (add outline comments)

## Conclusions

#TODO (add outline comments)

