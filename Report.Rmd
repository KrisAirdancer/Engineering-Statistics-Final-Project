---
title: "Final Project..."
author: "Ben Essex, Derek Che, & Chris Marston"
date: 04/02/2022
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Analysis

The first basic analsyis that was conducted on the gathered data was the computation of correlation coefficients and confidence intervals to accompany them. This analysis was conducted using the following data.

- Zoom attendence data collected at the University of Utah
- Temperature at 6AM and 6PM collected from OpenWeatherMaps
- Daily confirmed case count from the Salt Lake County dataset
- 7-day average case count from the Salt Lake County dataset
- 7-day average positive test rate from the Salt Lake County dataset

The correllations being evaluated in this section of the analysis are,

- Mean Attendence Rate vs Mean Daily Temperature
- Mean Attendence Rate vs Daily Confirmed New Case Count in Salt Lake County
- Mean Attendence Rate vs 7-Day Average Confirmed New Case Count in Salt Lake County
- Mean Attendence Rate vs 7-Day Average Positive Test Rate in Salt Lake County

To determine an attendance rate for each day Zoom attendence was recorded, an attendence rate was calculated for each class using the current enrollment for the associated class before these enrollment rates were averaged for each day on record.

Due to the complexity of calculating correlation coefficients for each of the courses based on temperature data collected for a specific time before each class began, the 6AM and 6PM temperatures were averaged to get an average daily temperature for the time period during which the classes were in session.

```{r, echo=FALSE}
# READING IN DATA

atd_and_weather_data = read.csv("data/3130 Final Project Data Sheet - Atd & Weather.csv")
atd_daily_temp_and_covid = read.csv("data/3130 Final Project Data Sheet - Mean Atd Rate, Mean Daily Temp, & COVID-19.csv")

```

```{r, echo=FALSE}
# FUNCTIONS

# Confidence Interval Calculation: https://www.statology.org/confidence-interval-correlation-coefficient/
# z-score Calculation: https://www.statology.org/z-score-r/

Fisher_Transformation = function(correlation_coefficent) {
    return(
        log( ( (1 + correlation_coefficent) / (1 - correlation_coefficent) ) ) / 2
    )
}

# Use our corellation coefficent for the data_value here
Z_Score = function(data_value, sample_mean, sample_sd) {
    return(
        ( data_value - sample_mean ) / sample_sd
    )
}

Log_Bounds = function(upper, fisher_transformed, z_score, sample_size) {
    if (upper == TRUE) # Calculate the upper bound
    {
        return(
            fisher_transformed + ( z_score / sqrt( sample_size - 3) )
        )
    }
    else # If upper is false, default to calculating the lower bound
    {
        return(
            fisher_transformed - ( z_score / sqrt( sample_size - 3) )
        )
    }
}

CI_Upper = function(log_upper_bound) {
    return(
        (exp(2 * log_upper_bound) - 1) / (exp(2 * log_upper_bound) + 1 )
    )
}

CI_Lower = function(log_lower_bound) {
    return(
        (exp(2 * log_lower_bound) - 1) / (exp(2 * log_lower_bound) + 1 )
    )
}


```

```{r, echo=FALSE}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- mean_daily_temp

# Find the Correlation Coefficent
mean_daily_temp_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$mean_daily_temp)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_temp_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence - assumes normally distributed data

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_temp = CI_Upper(log_upper_bound)

CI_lower_atd_vs_temp = CI_Lower(log_lower_bound)

```

```{r, echo=FALSE}
# CORRELATION COEFFICIENT & CONFIDENCE INFERVALS FOR mean_daily_atd_rate --- daily_confirmed_case_count

# Find the Correlation Coefficent
mean_daily_case_count_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                        atd_daily_temp_and_covid$daily_confirmed_case_count)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_case_count_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_case_count = CI_Upper(log_upper_bound)

CI_lower_atd_vs_case_count = CI_Lower(log_lower_bound)

```

```{r, echo=FALSE}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- confirmed_case_count_7d_avg (confirmed_7dcc)

# Find the Correlation Coefficent
mean_daily_confirmed_7dcc_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$confirmed_case_count_7d_avg)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_confirmed_7dcc_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_confirmed_7dcc = CI_Upper(log_upper_bound)

CI_lower_atd_vs_confirmed_7dcc = CI_Lower(log_lower_bound)

```

```{r, echo=FALSE}
# CORRELATION COEFFICIENT & CONFIDENCE INTERVALS FOR mean_daily_atd_rate --- positive_test_rate_7d_avg (positive_7dtr)

# Find the Correlation Coefficent
mean_daily_positive_7dtr_correlation = cor(atd_daily_temp_and_covid$mean_daily_atd_rate,
                                  atd_daily_temp_and_covid$positive_test_rate_7d_avg)

# Perform Fisher Transformation (this make the data "normally distributed" so that we can properly generate a confidence interval, which requires normally distributed data)
fisher_transformed = Fisher_Transformation( mean_daily_positive_7dtr_correlation )

# Calculate z-score
z_score = 1.96 # 95% confidence

# Find upper and lower bounds
log_upper_bound = Log_Bounds(TRUE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

log_lower_bound = Log_Bounds(FALSE, fisher_transformed, z_score, nrow( atd_daily_temp_and_covid ) )

# Find the confidence interval
CI_upper_atd_vs_positive_7dtr = CI_Upper(log_upper_bound)

CI_lower_atd_vs_positive_7dtr = CI_Lower(log_lower_bound)

```


A Pearson correlation coefficient was calculated for each of the dataset paris and a Fisher Transformation was performed on the result to yield a normally distributed variable.

A 95% confidence interval was then calcuated for each of the correlation coefficients and the upper and lower bounds of those intervals was determined.

The following are the results of this analysis:

- Mean Attendence Rate vs Mean Daily Temperature
    - Correlation Coefficient: `r round(mean_daily_temp_correlation, 4)`
    - Confidence Interval: `r round(CI_lower_atd_vs_temp, 4)`, `r round(CI_upper_atd_vs_temp, 4)`
- Mean Attendence Rate vs Daily Confirmed New Case Count in Salt Lake County
    - Correlation Coefficient: `r round(mean_daily_case_count_correlation, 4)`
    - Confidence Interval: `r round(CI_lower_atd_vs_case_count, 4)`, `r round(CI_upper_atd_vs_case_count, 4)`
- Mean Attendence Rate vs 7-Day Average Confirmed New Case Count in Salt Lake County
    - Correlation Coefficient: `r round(mean_daily_confirmed_7dcc_correlation, 4)`
    - Confidence Interval: `r round(CI_lower_atd_vs_confirmed_7dcc, 4)`, `r round(CI_upper_atd_vs_confirmed_7dcc, 4)`
- Mean Attendence Rate vs 7-Day Average Positive Test Rate in Salt Lake County
    - Correlation Coefficient: `r round(mean_daily_positive_7dtr_correlation, 4)`
    - Confidence Interval: `r round(CI_lower_atd_vs_positive_7dtr, 4)`, `r round(CI_upper_atd_vs_positive_7dtr, 4)`

